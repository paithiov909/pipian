---
title: "Setup for Google Colaboratory"
author: "Kato Akiru"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
header-includes:
  - \usepackage[utf8]{inputenc}
vignette: >
  %\VignetteIndexEntry{How to use on Colab}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Google Colaboratoryで試すやり方

Google Colaboratory上で試すことができる。

なお、Colab（この記事を書いた時点だとUbuntu 18.04.3 LTS）にCaboCha（ver.0.69）を公式のGoogleDriveからwgetなどして入れようとすると、何かの確認ダイアログに阻まれるはずなので、古い情報を載せているサイトからスニペットをコピペしてきてもDLできないことがあるが、この記事はそれに対応済みの例。

## CaboChaのセットアップ

まず、MeCabを入れる。

``` bash
%%bash
apt install mecab libmecab-dev mecab-ipadic-utf8
```

次にCRFを入れる。

``` bash
wget "https://drive.google.com/uc?export=download&id=0B4y35FiV1wh7QVR6VXJ5dWExSTQ" -O CRF++-0.58.tar.gz
tar -zxvf CRF++-0.58.tar.gz CRF++-0.58/
cd CRF++-0.58/
./configure
make
make install
ldconfig
cd ../
```

CaboChaを入れる。

``` py
!curl -sc /tmp/cookie "https://drive.google.com/uc?export=download&id=0B4y35FiV1wh7SDd1Q1dUQkZQaUU" > /dev/null
import re
with open('/tmp/cookie') as f:
    contents = f.read()
    print(contents)
    m = re.findall(r'_warning[\S]+[\s]+([a-zA-Z0-9]+)\n', contents)
    code = m[0]
url = f'https://drive.google.com/uc?export=download&confirm={code}&id=0B4y35FiV1wh7SDd1Q1dUQkZQaUU'
!curl -Lb /tmp/cookie "$url" -o cabocha-0.69.tar.bz2
!tar -jxvf cabocha-0.69.tar.bz2 cabocha-0.69/
%cd cabocha-0.69/
!./configure --with-mecab-config=`which mecab-config` --with-charset=UTF8
!make
!make check
!make install
!ldconfig
%cd ../
```

## {pipian}のインストール

rpy2経由でRを使えるようにする。

```
%load_ext rpy2.ipython
```

{pipian}を入れる。

``` r
%%R
remotes::install_github("paithiov909/pipian")
```

使用例。なお、これで`res$plot()`するとigraphを利用して係り受けを図示できるが、Colabは日本語フォントがない環境なのでうまく表示されない。図示したい場合は、日本語フォントを入れたうえで、`res$tbl2graph()`の戻り値であるigraphオブジェクトを利用するなどして自分で頑張ってください。

``` r
%%R
res <- pipian::CabochaTbl("ふつうに動くよ")
res$tbl
#> # A tibble: 2 x 4
#>   id    link  score    morphs  
#>   <chr> <chr> <chr>    <chr>   
#> 1 0     1     0.000000 ふつうに
#> 2 1     -1    0.000000 動くよ  
```
